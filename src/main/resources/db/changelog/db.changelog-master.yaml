databaseChangeLog:
  - changeSet:
      id: 1
      author: admin
      changes:
        - createTable:
            tableName: users
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: username
                  type: VARCHAR(20)
                  constraints:
                    nullable: false
              - column:
                  name: email
                  type: VARCHAR(50)
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: password_hash
                  type: TEXT
                  constraints:
                    nullable: false
              - column:
                  name: role_id
                  type: BIGINT
                  constraints:
                    nullable: false

        - createTable:
            tableName: comments
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: rating
                  type: SMALLINT
                  constraints:
                    nullable: false
                    check: "rating >= 1 AND rating <= 10"
              - column:
                  name: review
                  type: TEXT
                  constraints:
                    nullable: false
              - column:
                  name: created_at
                  type: TIMESTAMPTZ
                  defaultValueComputed: CURRENT_TIMESTAMP
              - column:
                  name: user_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: movie_id
                  type: BIGINT
              - column:
                  name: series_id
                  type: BIGINT

        - createTable:
            tableName: roles
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: name
                  type: VARCHAR(50)
                  constraints:
                    nullable: false
                    unique: true

        - createTable:
            tableName: crew_members
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: firstname
                  type: VARCHAR(50)
                  constraints:
                    nullable: false
              - column:
                  name: lastname
                  type: VARCHAR(50)
                  constraints:
                    nullable: false
              - column:
                  name: birth_date
                  type: DATE
                  constraints:
                    nullable: false
              - column:
                  name: bio
                  type: TEXT
              - column:
                  name: photo_url
                  type: TEXT

        - createTable:
            tableName: movies
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: title
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: description
                  type: TEXT
              - column:
                  name: release_date
                  type: DATE
                  constraints:
                    nullable: false
              - column:
                  name: duration
                  type: INTERVAL
                  constraints:
                    nullable: false
              - column:
                  name: poster_url
                  type: TEXT

        - createTable:
            tableName: series
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: title
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: description
                  type: TEXT
              - column:
                  name: start_date
                  type: DATE
                  constraints:
                    nullable: false
              - column:
                  name: end_date
                  type: DATE
              - column:
                  name: poster_url
                  type: TEXT

        - createTable:
            tableName: episodes
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: season
                  type: SMALLINT
                  constraints:
                    nullable: false
              - column:
                  name: episode
                  type: SMALLINT
                  constraints:
                    nullable: false
              - column:
                  name: title
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: description
                  type: TEXT
              - column:
                  name: release_date
                  type: DATE
                  constraints:
                    nullable: false
              - column:
                  name: duration
                  type: INTERVAL
                  constraints:
                    nullable: false
              - column:
                  name: series_id
                  type: BIGINT
                  constraints:
                    nullable: false

        - createTable:
            tableName: genres
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: name
                  type: VARCHAR(50)
                  constraints:
                    nullable: false
                    unique: true

        - createTable:
            tableName: movie_crew
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: movie_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: crew_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: role_id
                  type: BIGINT
                  constraints:
                    nullable: false

        - createTable:
            tableName: series_crew
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: series_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: crew_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: role_id
                  type: BIGINT
                  constraints:
                    nullable: false

        - createTable:
            tableName: movie_genres
            columns:
              - column:
                  name: movie_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: genre_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - constraints:
                  primaryKey:
                    columns: movie_id, genre_id

        - createTable:
            tableName: series_genres
            columns:
              - column:
                  name: series_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: genre_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - constraints:
                  primaryKey:
                    columns: series_id, genre_id

        - addForeignKeyConstraint:
            baseTableName: users
            baseColumnNames: role_id
            referencedTableName: roles
            referencedColumnNames: id
            constraintName: fk_users_roles

        - addForeignKeyConstraint:
            baseTableName: comments
            baseColumnNames: user_id
            referencedTableName: users
            referencedColumnNames: id
            onDelete: CASCADE
            constraintName: fk_comments_users

        - addForeignKeyConstraint:
            baseTableName: comments
            baseColumnNames: movie_id
            referencedTableName: movies
            referencedColumnNames: id
            onDelete: CASCADE
            constraintName: fk_comments_movies

        - addForeignKeyConstraint:
            baseTableName: comments
            baseColumnNames: series_id
            referencedTableName: series
            referencedColumnNames: id
            onDelete: CASCADE
            constraintName: fk_comments_series

        - addForeignKeyConstraint:
            baseTableName: episodes
            baseColumnNames: series_id
            referencedTableName: series
            referencedColumnNames: id
            onDelete: CASCADE
            constraintName: fk_episodes_series

        - addForeignKeyConstraint:
            baseTableName: movie_crew
            baseColumnNames: movie_id
            referencedTableName: movies
            referencedColumnNames: id
            onDelete: CASCADE
            constraintName: fk_movie_crew_movies

        - addForeignKeyConstraint:
            baseTableName: movie_crew
            baseColumnNames: crew_id
            referencedTableName: crew_members
            referencedColumnNames: id
            onDelete: CASCADE
            constraintName: fk_movie_crew_crew_members

        - addForeignKeyConstraint:
            baseTableName: movie_crew
            baseColumnNames: role_id
            referencedTableName: roles
            referencedColumnNames: id
            constraintName: fk_movie_crew_roles

        - addForeignKeyConstraint:
            baseTableName: series_crew
            baseColumnNames: series_id
            referencedTableName: series
            referencedColumnNames: id
            onDelete: CASCADE
            constraintName: fk_series_crew_series

        - addForeignKeyConstraint:
            baseTableName: series_crew
            baseColumnNames: crew_id
            referencedTableName: crew_members
            referencedColumnNames: id
            onDelete: CASCADE
            constraintName: fk_series_crew_crew_members

        - addForeignKeyConstraint:
            baseTableName: series_crew
            baseColumnNames: role_id
            referencedTableName: roles
            referencedColumnNames: id
            constraintName: fk_series_crew_roles

        - addForeignKeyConstraint:
            baseTableName: movie_genres
            baseColumnNames: movie_id
            referencedTableName: movies
            referencedColumnNames: id
            onDelete: CASCADE
            constraintName: fk_movie_genres_movies

        - addForeignKeyConstraint:
            baseTableName: movie_genres
            baseColumnNames: genre_id
            referencedTableName: genres
            referencedColumnNames: id
            onDelete: CASCADE
            constraintName: fk_movie_genres_genres

        - addForeignKeyConstraint:
            baseTableName: series_genres
            baseColumnNames: series_id
            referencedTableName: series
            referencedColumnNames: id
            onDelete: CASCADE
            constraintName: fk_series_genres_series

        - addForeignKeyConstraint:
            baseTableName: series_genres
            baseColumnNames: genre_id
            referencedTableName: genres
            referencedColumnNames: id
            onDelete: CASCADE
            constraintName: fk_series_genres_genres
